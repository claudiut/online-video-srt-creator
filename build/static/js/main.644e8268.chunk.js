(this["webpackJsonponline-video-srt-creator"]=this["webpackJsonponline-video-srt-creator"]||[]).push([[0],{41:function(e,t,n){},59:function(e,t,n){},60:function(e,t,n){"use strict";n.r(t);var r,i=n(0),c=n(2),a=n.n(c),s=n(32),o=n.n(s),u=(n(41),n(33)),l=n.n(u),d=n(7),f=n(64),v=n(62),j=n(65),h=n(34),b=n(63),m=n(3),p=function(e){return e.split(/[\n\r]+/)},O=function(e){return e.split(/[\n\r]{2,}/)},g=[["\xe3","\u0103"],["\xfe","\u021b"],["\xad","-"],[/\s+/g," "],[/-{2,}/g,"-"],[/\bcaci\b/g,"c\u0103ci"],[/\bCaci\b/g,"C\u0103ci"]],y=function(e){return"0"===e[0]&&e.length>1?/^[0]+$/.test(e)?"0":e.replace(/^[0]+/,""):e},x=function(e,t,n,r){return 3600*e+60*t+n+r/1e3},T="bypass-global-shortcuts",k={NONE:"none",LINE:"line",PARAGRAPH:"paragraph"},w=new f.a(""),S=new f.a(void 0),C=new f.a([]),N=S.pipe(Object(h.a)((function(e){return e?e.currentTime$:Object(v.a)(void 0)}))).pipe(Object(b.a)()),E=Object(j.a)([C,N]).pipe(Object(h.a)((function(e){var t=Object(d.a)(e,2),n=t[0],r=t[1];return r?function(e,t){return e.find((function(e){return e.isTimedFor(t)||e.hasOnlyStart()&&e.startsBeforeOrAt(t)}))}(n,r):void 0}))),P=function(e){return C.next(e)},I=function(e){var t=C.getValue();P(t.map((function(t){return t===e?e:t})))},A=function(e){return S.next(e)},D=n(18),R=function(e){var t=e instanceof f.a?e.getValue():void 0,n=Object(c.useState)(t),r=Object(d.a)(n,2),i=r[0],a=r[1];return Object(c.useEffect)((function(){var t=e.subscribe(a);return function(){t.unsubscribe()}}),[e]),i},F=function(e){var t=e.target.className;return t&&t.includes(T)},L=function(){var e=R(S),t=R(C);Object(c.useEffect)((function(){if(e){var n={space:{handler:function(t){F(t)||" "!==t.key||(t.preventDefault(),e.togglePlay())},type:"keydown"},leftArrow:{handler:function(t){F(t)||"ArrowLeft"!==t.key||(t.preventDefault(),e.seekPrevious())},type:"keydown"},rightArrow:{handler:function(t){F(t)||"ArrowRight"!==t.key||(t.preventDefault(),e.seekNext())},type:"keydown"},enter:{handler:function(n){if(!F(n)&&"Enter"===n.key){var r=e.getCurrentTime();n.preventDefault();var i=function(e){return e.findIndex((function(e){return!e.isTimed()}))}(t);if(-1===i)return;var c=t[i];void 0===c.getStartTime()?(c.setStartTime(r),function(e,t){if(0!==t){var n=e[t],r=e[t-1];n.getStartTime()&&r.getEndTime()&&n.getStartTime()-r.getEndTime()<.2&&n.setStartTime(r.getEndTime()+.001)}}(t,i)):void 0===c.getEndTime()&&c.setEndTime(r),P(Object(D.a)(t))}},type:"keydown"}},r={capture:!0};return Object.values(n).forEach((function(e){document.addEventListener(e.type,e.handler,r)})),function(){Object.values(n).forEach((function(e){document.removeEventListener(e.type,e.handler,r)}))}}}),[e,t])},M=n(11),$=n(12),W=function(){function e(t,n){Object(M.a)(this,e),this.currentTime$=void 0,this.player=void 0,this.player=t;var r=function(e){var t,n=e.match(/\?v=([^&]+)/);return null!==(t=null===n||void 0===n?void 0:n[1])&&void 0!==t?t:""}(n);r&&this.player.load(r),this.currentTime$=function(e){return new m.a((function(t){var n,r=setInterval((function(){var r=e.getCurrentTime();r!==n&&(t.next(r),n=r)}),5);return{unsubscribe:function(){clearInterval(r)}}}))}(this)}return Object($.a)(e,[{key:"isPlaying",value:function(){return"playing"===this.player.getState()}},{key:"togglePlay",value:function(){this.isPlaying()?this.player.pause():this.player.play()}},{key:"seekPrevious",value:function(){this.player.seek(this.player.getCurrentTime()-5)}},{key:"seekNext",value:function(){this.player.seek(this.player.getCurrentTime()+5)}},{key:"setCurrentTime",value:function(e){var t=this;if("cued"===this.player.getState()){var n=this.currentTime$.subscribe((function(r){r>0&&(t.player.pause(),n.unsubscribe(),t.player.seek(e))}));this.player.play()}else this.player.seek(e)}},{key:"getCurrentTime",value:function(){return this.player.getCurrentTime()}},{key:"dispose",value:function(){this.player.destroy()}}]),e}(),J="video-player",B=function(e){var t=e.url;return L(),Object(c.useEffect)((function(){if(t){var e=new W(new l.a("#".concat(J)),t);return A(e),function(){e.dispose()}}A(void 0)}),[t]),Object(i.jsx)("div",{id:"player-wrapper",children:Object(i.jsx)("div",{id:J})})},U=Object(c.memo)(B),V=function(e){var t=e.observable$,n=e.children,r=R(t);return Object(i.jsx)(i.Fragment,{children:n(r)})},Z=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";Object(M.a)(this,e),this.content="",this.startTime=void 0,this.endTime=void 0,this.setContent(t)}return Object($.a)(e,[{key:"setContent",value:function(e){var t;this.content=(t=e,Object.values(g).forEach((function(e){var n=Object(d.a)(e,2),r=n[0],i=n[1];return t=t.replaceAll(r,i)})),p(t).map((function(e){return e.trim()})).join("\n"))}},{key:"getContent",value:function(){return this.content}},{key:"setStartTime",value:function(e){this.startTime=e}},{key:"getStartTime",value:function(){return this.startTime}},{key:"setEndTime",value:function(e){this.endTime=e}},{key:"removeStartTime",value:function(){this.startTime=void 0}},{key:"removeEndTime",value:function(){this.endTime=void 0}},{key:"getEndTime",value:function(){return this.endTime}},{key:"isTimed",value:function(){return!(!this.startTime||!this.endTime)}},{key:"isTimedFor",value:function(e){return this.isTimed()&&e>=this.startTime&&e<this.endTime}},{key:"hasOnlyStart",value:function(){return void 0===this.getEndTime()&&void 0!==this.getStartTime()}},{key:"startsBeforeOrAt",value:function(e){return this.getStartTime()<=e}}]),e}(),H=n(35),G=function(){function e(){Object(M.a)(this,e)}return Object($.a)(e,null,[{key:"toDto",value:function(e){return{content:e.getContent(),startTime:e.getStartTime(),endTime:e.getEndTime()}}},{key:"fromDto",value:function(e){var t=new Z(e.content);return e.startTime&&t.setStartTime(e.startTime),e.endTime&&t.setEndTime(e.endTime),t}},{key:"numberWithZeroPadding",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:2;return e.toString().padStart(t,"0")}},{key:"secondsWithMsToSrtTimeString",value:function(e){var t=216e3,n=Math.floor(e/t),r=Math.floor((e-n*t)/60),i=Math.floor(e-n*t-60*r),c=Math.floor(1e3*(e-n*t-60*r-i)),a=this.numberWithZeroPadding(n),s=this.numberWithZeroPadding(r),o=this.numberWithZeroPadding(i),u=c?c.toString():"000";return"".concat(a,":").concat(s,":").concat(o,",").concat(u)}},{key:"toSrt",value:function(e){var t=this;return e.filter((function(e){return e.isTimed()})).map((function(e,n){return["".concat(n+1),"".concat(t.secondsWithMsToSrtTimeString(e.getStartTime())," --\x3e ").concat(t.secondsWithMsToSrtTimeString(e.getEndTime())),e.getContent()].join("\n")})).join("\n\n")}},{key:"parseSrt",value:function(e){console.log("srtContents",e);var t,n="(\\d+):(\\d+):(\\d+),(\\d+)",r=new RegExp("(\\d+)".concat("\n").concat(n,"\\s--\x3e\\s").concat(n).concat("\n","(.+)(").concat("\n\n",")?"),"g"),i=e.matchAll(r),c=[],a=Object(H.a)(i);try{for(a.s();!(t=a.n()).done;){var s=t.value;console.log(s);var o=new Z(s[10]),u=parseInt(y(s[2])),l=parseInt(y(s[3])),d=parseInt(y(s[4])),f=parseInt(y(s[5]));console.log(u,l,d,f),o.setStartTime(x(u,l,d,f));var v=parseInt(y(s[6])),j=parseInt(y(s[7])),h=parseInt(y(s[8])),b=parseInt(y(s[9]));o.setEndTime(x(v,j,h,b)),c.push(o)}}catch(m){a.e(m)}finally{a.f()}return c}}]),e}(),q=Object(c.forwardRef)((function(e,t){var n=e.onSave,r=e.onCancel,a=Object(c.useState)(""),s=Object(d.a)(a,2),o=s[0],u=s[1],l=Object(c.useState)(k.NONE),f=Object(d.a)(l,2),v=f[0],j=f[1];return Object(i.jsxs)("form",{onSubmit:function(e){e.preventDefault(),o&&(n(o,v),u(""))},children:[Object(i.jsx)("div",{children:Object(i.jsx)("textarea",{rows:30,value:o,className:"w-100 ".concat(T),onChange:function(e){var t=e.target.value;return u(t)},ref:t})}),Object(i.jsxs)("div",{className:"flex justify-between",children:[Object(i.jsx)("div",{children:Object(i.jsx)("button",{type:"reset",onClick:r,children:"Cancel"})}),Object(i.jsxs)("div",{children:["Split by",Object(i.jsx)("select",{value:v,onChange:function(e){j(e.target.value)},children:Object.values(k).map((function(e){return Object(i.jsx)("option",{value:e,children:e},e)}))}),Object(i.jsx)("button",{type:"submit",children:"Save"})]})]})]})})),z=function(e){var t=e.translations,n=Object(c.useState)(!1),r=Object(d.a)(n,2),a=r[0],s=r[1];return Object(i.jsxs)("div",{children:[a&&Object(i.jsx)(q,{onSave:function(e,n){!function(e,t,n){if(e=e.trim(),t!==k.NONE){var r=(t===k.LINE?p:O)(e).map((function(e){return new Z(e)}));P([].concat(Object(D.a)(n),Object(D.a)(r)))}else P([].concat(Object(D.a)(n),[new Z(e)]))}(e,n,t),s(!1)},onCancel:function(){return s(!1)}}),Object(i.jsx)("div",{children:Object(i.jsx)("button",{onClick:function(){s(!a)},style:{visibility:a?"hidden":"visible"},children:"Add Translation"})}),Object(i.jsxs)("div",{className:"pa3",children:[Object(i.jsx)("div",{children:"Help"}),Object(i.jsxs)("ol",{children:[Object(i.jsx)("li",{children:"Press Space to play/pause the video and left/right arrow to jump back/forward"}),Object(i.jsx)("li",{children:"Press Enter to set the start/end time of translation to current video position"})]})]}),Object(i.jsxs)("div",{className:"tc flex",children:["Import SRT:\xa0",Object(i.jsx)("input",{type:"file",onChange:function(e){if(e.target.files){var t=new FileReader;t.onload=function(e){if(e.target){var t=G.parseSrt(e.target.result);P(t)}else console.log("File is empty!",e.target)},t.onerror=function(e){console.log("Error loading file",e)},t.readAsText(e.target.files[0],"UTF-8")}},accept:".srt",multiple:!1}),Object(i.jsxs)("button",{disabled:!t.length,onClick:function(){var e=document.createElement("a"),n=G.toSrt(t);e.setAttribute("href","data:text/plain;charset=utf-8,"+encodeURIComponent(n));var r="".concat(t[0].getContent().split("\n")[0],".srt");e.setAttribute("download",r),e.style.display="none",document.body.appendChild(e),e.click(),document.body.removeChild(e)},children:["Download",Object(i.jsx)("br",{}),"\u2b07"]})]})]})},K=function(){return Object(i.jsxs)("div",{className:"w-100 flex pa1",children:[Object(i.jsxs)("div",{className:"w-third flex",children:[Object(i.jsx)("strong",{className:"w-50",children:"Start"}),Object(i.jsx)("strong",{className:"w-50",children:"End"})]}),Object(i.jsx)("div",{className:"w-third",children:Object(i.jsx)("strong",{children:"Subtitle"})}),Object(i.jsx)("div",{className:"w-third",children:Object(i.jsx)("strong",{children:"Actions"})})]})},Q=function(e){return e?Math.trunc(1e4*e)/1e4:"-"},X=function(e){var t=e.translation,n=e.isCurrentlyPreviewed,r=void 0!==n&&n,c=e.player,a=t.getStartTime(),s=function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];e?t.removeStartTime():t.removeEndTime(),I(t)},o=function(){!function(e){var t=C.getValue();P(t.filter((function(t){return t!==e})))}(t)};return Object(i.jsxs)("div",{onClick:function(){c&&a&&c.setCurrentTime(a)},className:"w-100 flex translation-line items-center\n                ".concat(r?"previewing":"","\n                ").concat(a?"scheduled":"","\n                "),children:[Object(i.jsxs)("div",{className:"w-third flex",children:[Object(i.jsx)("div",{className:"w-50",children:Q(a)}),Object(i.jsx)("div",{className:"w-50",children:Q(t.getEndTime())})]}),Object(i.jsx)("div",{className:"w-third",children:Object(i.jsx)("span",{className:"pre",children:t.getContent()})}),Object(i.jsxs)("div",{className:"w-third flex",children:[Object(i.jsx)("button",{onClick:function(e){e.stopPropagation(),s(),document.body.focus()},children:"ResetStart"}),Object(i.jsx)("button",{onClick:function(e){e.stopPropagation(),s(!1),document.body.focus()},children:"ResetEnd"}),Object(i.jsx)("button",{onClick:function(e){e.stopPropagation(),o(),document.body.focus()},children:"Delete"})]})]})},Y=(n(59),function(e){var t=e.translations,n=R(E),r=R(S);return Object(i.jsx)("div",{id:"translations",className:"overflow-y-auto pa1 ".concat(t.length>0?"has-translations":""),children:t.map((function(e,t){return Object(i.jsx)(X,{translation:e,isCurrentlyPreviewed:e===n,player:r},t)}))})}),_=function(){return Object(i.jsxs)("div",{className:"flex flex-column w-100",children:[Object(i.jsx)(K,{}),Object(i.jsx)(V,{observable$:C,children:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Object(i.jsxs)(i.Fragment,{children:[Object(i.jsx)(Y,{translations:e}),Object(i.jsx)(z,{translations:e})]})}})]})},ee=function(e){var t=e.previewedTranslation;return Object(i.jsx)("div",{className:"tc pa2 f4",children:Object(i.jsx)("span",{className:"pre",children:t.getContent()})})},te=function(){return Object(i.jsx)("div",{className:"flex justify-center h-100",children:Object(i.jsxs)("div",{className:"w-100 w-70-m flex flex-column",children:[Object(i.jsx)("div",{children:Object(i.jsx)("input",{type:"text",placeholder:"Video URL",className:"w-100",onChange:function(e){return t=(e.target.value||"").trim(),w.next(t);var t}})}),Object(i.jsxs)("div",{className:"flex h-100",children:[Object(i.jsx)(V,{observable$:w,children:function(e){return e?Object(i.jsxs)("div",{children:[Object(i.jsx)(U,{url:e}),Object(i.jsx)(V,{observable$:E,children:function(e){return e&&Object(i.jsx)(ee,{previewedTranslation:e})}})]}):Object(i.jsx)("div",{className:"flex justify-center items-center tc pa2",children:"Please enter a video URL in the text field above"})}}),Object(i.jsx)(_,{})]})]})})},ne=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,66)).then((function(t){var n=t.getCLS,r=t.getFID,i=t.getFCP,c=t.getLCP,a=t.getTTFB;n(e),r(e),i(e),c(e),a(e)}))},re="translation";r=new(function(){function e(){Object(M.a)(this,e)}return Object($.a)(e,[{key:"set",value:function(e){var t=e.map((function(e){return G.toDto(e)}));sessionStorage.setItem(re,JSON.stringify(t))}},{key:"get",value:function(){var e=sessionStorage.getItem(re)||JSON.stringify([]);return JSON.parse(e).map((function(e){return G.fromDto(e)}))}}]),e}()),P(r.get()),C.subscribe((function(e){r.set(e)})),o.a.render(Object(i.jsx)(a.a.StrictMode,{children:Object(i.jsx)(te,{})}),document.getElementById("root")),ne()}},[[60,1,2]]]);
//# sourceMappingURL=main.644e8268.chunk.js.map